# Sikuwa 使用指南

Sikuwa 是一个基于 Nuitka 的跨平台 Python 应用构建工具，支持一键打包 Python 项目为可执行文件，v1.3.0 版本新增智能缓存系统，大幅提升构建效率。

## 安装

### 前置要求
- Python 3.7+
- Nuitka 0.6.18+
- 系统编译器（如 Windows 上的 MinGW 或 MSVC）

### 安装步骤

1. 安装 Nuitka：
   ```bash
   pip install nuitka
   ```

2. 安装 Sikuwa：
   ```bash
   pip install sikuwa
   ```

## 核心特性

### 智能缓存系统
Sikuwa v1.3.0 引入了全新的智能缓存系统，基于 C++ 实现的高性能 LRU 缓存算法，为重复构建提供显著的速度提升：

- **高性能设计**：C++ 核心算法，Python 包装器接口
- **智能缓存键**：基于文件内容和构建参数自动生成唯一键
- **自动管理**：与构建流程深度集成，无需手动配置
- **兼容性保障**：纯 Python 回退机制，确保在不同环境下正常工作
- **性能提升**：首次构建约 30 秒，缓存命中时仅需约 1.5 秒

## 快速开始

### 1. 初始化项目

在项目根目录执行以下命令创建默认配置文件：

```bash
sikuwa init
```

这将生成 `sikuwa.toml` 配置文件。

### 2. 配置项目

编辑 `sikuwa.toml` 文件，配置项目信息：

```toml
[project]
name = "my_project"
version = "1.0.0"
description = "我的 Python 项目"
author = "作者名"

[build]
main_script = "main.py"
src_dir = "src"
output_dir = "dist"
build_dir = "build"
platforms = ["windows", "linux"]

[nuitka]
standalone = true
onefile = true
enable_console = true
follow_imports = true
show_progress = true

[resources]
files = [
    "assets/icon.ico",
    "config.json"
]
folders = [
    "assets/images"
]
```

### 3. 构建项目

执行以下命令开始构建：

```bash
sikuwa build
```

构建完成后，可执行文件将生成在 `dist` 目录中。

## 命令列表

### init - 初始化项目配置

创建默认的 sikuwa.toml 配置文件。

```bash
sikuwa init [选项]
```

**选项：**
- `-o, --output`: 输出配置文件名（默认: sikuwa.toml）
- `--force`: 覆盖已存在的文件

**示例：**
```bash
sikuwa init                     # 创建 sikuwa.toml
sikuwa init -o custom.toml      # 创建自定义配置文件
sikuwa init --force             # 强制覆盖已存在的文件
```

### build - 构建项目

构建项目为可执行文件，集成智能缓存系统，大幅提升重复构建效率。

```bash
sikuwa build [选项]
```

**选项：**
- `-c, --config`: 配置文件路径（默认: sikuwa.toml）
- `-p, --platform`: 目标平台（默认: 构建所有平台）
  - 值: windows, linux, macos
- `-v, --verbose`: 详细输出模式
- `-f, --force`: 强制重新构建（忽略缓存）

**缓存系统工作原理：**
1. 自动生成缓存键：基于源文件内容、构建参数和命令行选项
2. 缓存检查：构建前检查是否存在有效缓存
3. 缓存命中：如果缓存有效，跳过编译过程，直接使用缓存结果
4. 缓存更新：构建完成后自动更新缓存

**缓存性能：**
- 首次构建：约 30 秒（根据项目大小可能有所不同）
- 缓存命中：约 1.5 秒

**注意事项：**
- 使用 `--force` 选项可以强制忽略缓存，执行完整构建
- 缓存目录位于构建目录下的 `.smart_cache` 文件夹
- 缓存会自动管理大小，无需手动清理

**示例：**
```bash
sikuwa build                    # 构建所有平台
sikuwa build -p windows         # 只构建 Windows 平台
sikuwa build -v                 # 详细输出
sikuwa build -c my_config.toml  # 使用指定配置文件
```

### clean - 清理构建文件

删除构建过程中生成的所有文件和目录。

```bash
sikuwa clean [选项]
```

**选项：**
- `-c, --config`: 配置文件路径（默认: sikuwa.toml）
- `-v, --verbose`: 详细输出模式

**示例：**
```bash
sikuwa clean        # 清理构建文件
sikuwa clean -v     # 详细输出
```

### info - 显示项目信息

显示当前项目的配置信息。

```bash
sikuwa info [选项]
```

**选项：**
- `-c, --config`: 配置文件路径（默认: sikuwa.toml）

**示例：**
```bash
sikuwa info                     # 显示项目信息
sikuwa info -c custom.toml      # 显示指定配置文件的信息
```

### validate - 验证配置文件

检查配置文件是否正确。

```bash
sikuwa validate [选项]
```

**选项：**
- `-c, --config`: 配置文件路径（默认: sikuwa.toml）

**示例：**
```bash
sikuwa validate                 # 验证默认配置文件
sikuwa validate -c custom.toml  # 验证指定配置文件
```

### doctor - 检查构建环境

检查系统环境和依赖项是否满足构建要求。

```bash
sikuwa doctor
```

### version - 显示版本信息

显示 Sikuwa 的版本信息。

```bash
sikuwa version
```

## 配置文件详解

### 项目配置 [project]

```toml
[project]
name = "项目名称"
version = "版本号"
description = "项目描述"
author = "作者名"
```

### 构建配置 [build]

```toml
[build]
main_script = "main.py"           # 项目入口文件
src_dir = "src"                   # 源代码目录
output_dir = "dist"               # 输出目录
build_dir = "build"               # 构建临时目录
platforms = ["windows", "linux"] # 目标平台
```

### Nuitka 配置 [nuitka]

```toml
[nuitka]
standalone = true                 # 独立打包
onefile = true                    # 单个可执行文件
enable_console = true             # 启用控制台
follow_imports = true             # 跟随导入
show_progress = true              # 显示进度
include_packages = []             # 包含的包
exclude_packages = []             # 排除的包
```

### 资源配置 [resources]

```toml
[resources]
files = [                         # 要包含的文件
    "assets/icon.ico",
    "config.json"
]
folders = [                       # 要包含的文件夹
    "assets/images"
]
```

## 平台支持

| 平台 | 支持状态 | 编译器要求 |
|------|----------|------------|
| Windows | ✅ | MinGW 或 MSVC |
| Linux | ✅ | GCC |
| macOS | ✅ | Clang |

## 常见问题

### Q: 构建失败，提示找不到模块
A: 检查 `nuitka.include_packages` 配置，确保所有依赖的包都已包含。

### Q: 可执行文件运行时缺少资源文件
A: 检查 `resources` 配置，确保所有需要的文件和文件夹都已添加到配置中。

### Q: Windows 上构建失败，提示找不到编译器
A: 安装 MinGW 并确保其路径已添加到系统环境变量中。

### Q: 构建的可执行文件太大
A: 可以尝试以下优化：
   - 将 `onefile` 设置为 `false`
   - 减少 `include_packages` 中的包数量
   - 优化项目的依赖结构

## 环境变量

Sikuwa 支持通过环境变量控制语言：

```bash
# 英文界面
set LANG=en_US.UTF-8  # Windows
export LANG=en_US.UTF-8  # Linux/macOS
```

## 技术支持

如果遇到问题，可以访问项目的 GitHub 仓库：
https://github.com/FORGE24/Sikuwa/

或查看官方文档：
https://www.sanrol-cloud.top
